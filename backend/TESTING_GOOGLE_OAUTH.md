# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Google OAuth

## –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

‚úÖ **–£–±—Ä–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ PKCE** - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º —Å Google OAuth API  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∏ redirect_uri  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤  
‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö  

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. –£–¥–∞–ª–µ–Ω–∏–µ PKCE
- **–ü—Ä–æ–±–ª–µ–º–∞**: PKCE –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è Google OAuth API –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–ª–∏ PKCE –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ authorization URL –∏ token exchange

### 2. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ OAuth

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å 400 –æ—à–∏–±–∫—É
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∏ —Ñ–æ—Ä–º–∞—Ç authorization code

### 4. –¢–∞–π–º–∞—É—Ç—ã
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–≤–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Google API
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏–ª–∏ 30-—Å–µ–∫—É–Ω–¥–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–∞

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backend —Å–µ—Ä–≤–µ—Ä
```bash
cd backend
python -m uvicorn src.main:app --reload --host 0.0.0.0 --port 8000 --log-level debug
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend —Å–µ—Ä–≤–µ—Ä
```bash
cd frontend
npm run dev
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Google OAuth
1. –û—Ç–∫—Ä—ã—Ç—å `http://localhost:3000/auth`
2. –ù–∞–∂–∞—Ç—å "Continue with Google"
3. –ü—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ Google
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend

### –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
–ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- `üîç Google OAuth callback API called with:`
- `üîç Parameters being sent to Google:`
- `üîç Token exchange response status:`
- `‚úÖ Token exchange successful` –∏–ª–∏ `‚ùå Token exchange failed`

## –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞: "invalid_grant"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π authorization code
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ code –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ redirect_uri —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–¥ –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω (–¥–µ–π—Å—Ç–≤—É–µ—Ç ~10 –º–∏–Ω—É—Ç)

### –û—à–∏–±–∫–∞: "redirect_uri_mismatch"
**–ü—Ä–∏—á–∏–Ω–∞**: Redirect URI –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –≤ Google Cloud Console
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ redirect URIs –≤ Google Cloud Console
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ URI

### –û—à–∏–±–∫–∞: "invalid_client"
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π client_id –∏–ª–∏ client_secret
**–†–µ—à–µ–Ω–∏–µ**: 
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials —Ñ–∞–π–ª
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ client_id –∏ client_secret –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```bash
cd backend
python test_google_oauth.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ redirect URIs
–í Google Cloud Console ‚Üí API & Services ‚Üí Credentials:
- `http://localhost:3000/auth/google/callback`
- `http://localhost:5173/auth/google/callback`
- `http://localhost:8000/api/auth/google/callback`
- `https://ravenai.site/auth/google/callback`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth Consent Screen
- –°—Ç–∞—Ç—É—Å: External
- –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: Yes (–∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã test users)
- Scopes: –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ dashboard  
‚úÖ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏**: –í–∏–¥–Ω—ã –≤—Å–µ —ç—Ç–∞–ø—ã OAuth –ø—Ä–æ—Ü–µ—Å—Å–∞  
‚úÖ **–ù–µ—Ç –æ—à–∏–±–æ–∫ 400**: –¢–æ–∫–µ–Ω—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ  
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω**: –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (OAuth –∫–æ–¥—ã –∏–º–µ—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (firewall, proxy)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Google OAuth API –≤ Google Cloud Console
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º –∏–ª–∏ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ —Ä–µ–∂–∏–º–æ–º
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤ —Ä–µ–∂–∏–º–µ "Testing" –≤ Google Cloud Console 